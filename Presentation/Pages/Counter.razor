@page "/counter"


<MudPaper Style="width: fit-content; padding: 0 10px; background-color: #46355f; border: 5px solid #853ba2;" Elevation="10" Square>
    <MudPaper Style="background-color: #35d446; margin: 5px -5px;" Outlined Square Elevation="5">
        <MudText Align="Align.Center" Color="Color.Dark" Style="margin: 5px;" Typo="Typo.h5">
            Matrix Input
        </MudText>
    </MudPaper>
    @*
    <MudStack Row Justify="Justify.FlexStart" AlignItems="AlignItems.Center" Spacing="1">
    <MudIconButton Icon="@Icons.Material.Outlined.ArrowBackIos"
    ButtonType="ButtonType.Button"
    Size="Size.Small"
    Edge="Edge.Start"
    DropShadow
    Ripple
    Color="Color.Primary"
    Variant="Variant.Filled"
    OnClick="@(() => { Columns--; })" />
    <MudStack Row="false" Justify="Justify.Center" AlignItems="AlignItems.Center" Spacing="0">
    <MudIconButton Icon="@CustomIcons.ArrowUpIos"
    ButtonType="ButtonType.Button"
    Size="Size.Small"
    Edge="Edge.Start"
    DropShadow
    Ripple
    Color="Color.Tertiary"
    Variant="Variant.Filled"
    OnClick="@(() => { Rows--; })" />
    <MudIconButton Icon="@Icons.Material.Filled.Circle"
    ButtonType="ButtonType.Button"
    Size="Size.Small"
    Edge="Edge.Start"
    Disabled
    Color="Color.Transparent"
    Variant="Variant.Outlined"
    OnClick="@(() => { Rows--; })" />
    <MudIconButton Icon="@CustomIcons.ArrowDownIos"
    ButtonType="ButtonType.Button"
    Size="Size.Small"
    Edge="Edge.Start"
    DropShadow
    Ripple
    Color="Color.Tertiary"
    Variant="Variant.Filled"
    OnClick="@(() => { Rows++; })" />
    </MudStack>
    <MudIconButton Icon="@Icons.Material.Outlined.ArrowForwardIos"
    ButtonType="ButtonType.Button"
    Size="Size.Small"
    Edge="Edge.Start"
    DropShadow
    Ripple
    Color="Color.Primary"
    Variant="Variant.Filled"
    OnClick="@(() => { Columns++; })" />
    </MudStack> *@
    <MudStack Style="width: fit-content;" Row="false" Justify="Justify.Center" AlignItems="AlignItems.Start">
        <MudStack Style="width: 100%;" Row Justify="Justify.FlexStart" AlignItems="AlignItems.Center">
            <MudText Typo="Typo.h6" Inline Color="Color.Tertiary">
                Rows
            </MudText>
            <MudText Typo="Typo.h6" Inline Color="Color.Error">
                ×
            </MudText>
            <MudText Typo="Typo.h6" Inline Color="Color.Tertiary">
                Columns
            </MudText>
        </MudStack>
        <MudStack Style="width: 100%;" Row Justify="Justify.FlexStart" AlignItems="AlignItems.Center">
            <MudStack Row Spacing="1" Justify="Justify.Center" AlignItems="AlignItems.Center">
                <MudNumericField Style="color: black; background-color: white; width: 45px; height: 45px;" @bind-Value="@Rows" Immediate Placeholder="Rows" Variant="Variant.Outlined" Underline="false" HideSpinButtons />
                <MudStack Row="false" Justify="Justify.Center" AlignItems="AlignItems.Center" Spacing="0">
                    <MudIconButton Icon="@CustomIcons.ArrowUpIos"
                                   ButtonType="ButtonType.Button"
                                   Size="Size.Small"
                                   DropShadow
                                   Ripple
                                   OnClick="@(() => { Rows--; })" />

                    <MudIconButton Icon="@CustomIcons.ArrowDownIos"
                                   ButtonType="ButtonType.Button"
                                   Size="Size.Small"
                                   DropShadow
                                   Ripple
                                   OnClick="@(() => { Rows++; })" />
                </MudStack>
            </MudStack>
            <MudStack Row Spacing="1" Justify="Justify.FlexStart">
                <MudNumericField Style="color: black; background-color: white; width: 45px; height: 45px;" @bind-Value="@Columns" Immediate Placeholder="Columns" Variant="Variant.Outlined" Underline="false" HideSpinButtons />
                <MudStack Row Justify="Justify.Center" AlignItems="AlignItems.Center" Spacing="0">
                    <MudIconButton Icon="@Icons.Material.Outlined.ArrowBackIos"
                                   ButtonType="ButtonType.Button"
                                   Size="Size.Small"
                                   DropShadow
                                   Ripple
                                   OnClick="@(() => { Columns--; })" />

                    <MudIconButton Icon="@Icons.Material.Outlined.ArrowForwardIos"
                                   ButtonType="ButtonType.Button"
                                   Size="Size.Small"
                                   DropShadow
                                   Ripple
                                   OnClick="@(() => { Columns++; })" />
                </MudStack>
            </MudStack>
        </MudStack>
    </MudStack>

    <br />

    <div align="center">
        <table class="matrix">
            @for (int i = 0; i < Rows; i++)
            {
                int myI = i;
                <tr>
                    @for (int j = 0; j < Columns; j++)
                    {
                        int myJ = j;
                        <td>
                            <MudTextField Style="color: white !important;height: 50px;width: 50px;" Class="matrix-input" @bind-Value="@Matrix[myI][myJ]" Variant="Variant.Filled" Underline="false" FullWidth="false" />
                        </td>
                    }
                </tr>
            }
        </table>
    </div>
</MudPaper>




@code {
    private int _rows = 3;
    private int _columns = 3;

    public int Rows
    {
        get => _rows;
        set
        {
            if (value < 1)
            {
                value = 1;
            }
            else if (value > Settings.MaxRowsAllowed)
            {
                value = Settings.MaxRowsAllowed;
            }

            _rows = value;
            UpdateMatrixRows();
        }
    }

    public int Columns
    {
        get => _columns;
        set
        {
            if (value < 1)
            {
                value = 1;
            }
            else if (value > Settings.MaxRowsAllowed)
            {
                value = Settings.MaxRowsAllowed;
            }

            _columns = value;
            UpdateMatrixColumns();
        }
    }

    List<List<string>> Matrix = new();

    private void UpdateMatrixRows()
    {
        int difference = Rows - Matrix.Count;

        if (difference > 0)
        {
            for (int i = 0; i < difference; i++)
            {
                Matrix.Add(new List<string>(new string[Columns]));
            }
        }
        else if (difference < 0)
        {
            for (int i = 0; i < -difference; i++)
            {
                Matrix.RemoveAt(Matrix.Count - 1);
            }
        }
    }

    private void UpdateMatrixColumns()
    {
        if (Matrix.Count == 0)
            return;

        int currentColumnCount = Matrix[0].Count;
        int difference = Columns - currentColumnCount;

        if (difference > 0)
        {
            foreach (var row in Matrix)
            {
                for (int j = 0; j < difference; j++)
                {
                    row.Add(string.Empty);
                }
            }
        }
        else if (difference < 0)
        {
            foreach (var row in Matrix)
            {
                for (int j = 0; j < -difference; j++)
                {
                    row.RemoveAt(row.Count - 1);
                }
            }
        }
    }

    protected override void OnInitialized()
    {
        for (int i = 0; i < Rows; i++)
        {
            Matrix.Add(new List<string>(new string[Columns]));
        }

        base.OnInitialized();
    }
}
